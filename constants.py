"""
Business Constants Module

Централизованное хранение всех бизнес-констант приложения.
Эти константы не зависят от окружения и не содержат секретов.
"""

from typing import Dict, List

# ====================================================================================
# TARIFFS - Тарифы подписок
# ====================================================================================
# Структура: tariff_type -> period_days -> price (в рублях)
TARIFFS: Dict[str, Dict[int, Dict[str, int]]] = {
    "basic": {
        30: {"price": 149},      # 1 месяц
        90: {"price": 399},      # 3 месяца
        180: {"price": 749},     # 6 месяцев
        365: {"price": 1399},    # 12 месяцев
    },
    "plus": {
        30: {"price": 299},      # 1 месяц
        90: {"price": 699},      # 3 месяца
        180: {"price": 1199},    # 6 месяцев
        365: {"price": 2299},    # 12 месяцев
    }
}

# ====================================================================================
# BALANCE TOP-UP - Пополнение баланса
# ====================================================================================
# Суммы пополнения баланса (в рублях)
BALANCE_TOPUP_AMOUNTS: List[int] = [250, 750, 999]

# Минимальная и максимальная сумма пополнения (в рублях)
MIN_TOPUP_AMOUNT: int = 100
MAX_TOPUP_AMOUNT: int = 100000

# ====================================================================================
# SBP DETAILS - Реквизиты СБП (для оплаты)
# ====================================================================================
# ВНИМАНИЕ: Эти данные должны быть заменены на реальные в production
SBP_DETAILS: Dict[str, str] = {
    "bank": "Банк",
    "account": "12345678901234567890",
    "name": "ИП Иванов Иван Иванович",
}

# ====================================================================================
# VPN CONFIGURATION - VPN конфигурация
# ====================================================================================
# Файл с VPN-ключами (DEPRECATED - больше не используется, ключи создаются через Xray API)
VPN_KEYS_FILE: str = "vpn_keys.txt"

# ====================================================================================
# RETRY & TIMEOUT CONSTANTS - Константы для retry и таймаутов
# ====================================================================================

# VPN API Retry Configuration
VPN_API_MAX_RETRIES: int = 2  # Количество повторных попыток (2 retry = 3 попытки всего)
VPN_API_RETRY_DELAY: float = 1.0  # Задержка между попытками в секундах
VPN_API_HTTP_TIMEOUT: float = 10.0  # Таймаут HTTP запросов (≥ 10 секунд)

# Database Pool Configuration
DB_POOL_MIN_SIZE: int = 1
DB_POOL_MAX_SIZE: int = 10
DB_POOL_COMMAND_TIMEOUT: float = 30.0  # Таймаут выполнения команд (30 секунд)

# ====================================================================================
# INTERVAL CONSTANTS - Интервалы для фоновых задач
# ====================================================================================

# Fast Expiry Cleanup - интервал проверки истёкших подписок (в секундах)
# По умолчанию: 60 секунд (1 минута)
# Диапазон: 60-300 секунд (1-5 минут)
CLEANUP_INTERVAL_SECONDS_MIN: int = 60
CLEANUP_INTERVAL_SECONDS_MAX: int = 300
CLEANUP_INTERVAL_SECONDS_DEFAULT: int = 60

# Auto Renewal - интервал проверки автопродления (в секундах)
# По умолчанию: 600 секунд (10 минут)
# Диапазон: 300-900 секунд (5-15 минут)
AUTO_RENEWAL_INTERVAL_SECONDS_MIN: int = 300
AUTO_RENEWAL_INTERVAL_SECONDS_MAX: int = 900
AUTO_RENEWAL_INTERVAL_SECONDS_DEFAULT: int = 600

# Auto Renewal - окно для автопродления (в часах)
# По умолчанию: 6 часов
RENEWAL_WINDOW_HOURS_DEFAULT: int = 6
RENEWAL_WINDOW_HOURS_MIN: int = 1

# ====================================================================================
# REFERRAL CONSTANTS - Реферальная система
# ====================================================================================

# Уровни реферальной системы и проценты кешбэка
REFERRAL_LEVELS: Dict[str, int] = {
    "base": 5,   # Базовый уровень: 5%
    "vip": 10,   # VIP уровень: 10%
}

# Минимальное количество оплативших рефералов для VIP уровня
REFERRAL_VIP_THRESHOLD: int = 5

# ====================================================================================
# PROMO CODE CONSTANTS - Промокоды
# ====================================================================================

# TTL для промо-сессий (в секундах)
# По умолчанию: 300 секунд (5 минут)
PROMO_SESSION_TTL_SECONDS: int = 300

# ====================================================================================
# VALIDATION CONSTANTS - Валидация
# ====================================================================================

# Минимальная и максимальная длина промокода
PROMO_CODE_MIN_LENGTH: int = 3
PROMO_CODE_MAX_LENGTH: int = 50

# Минимальная и максимальная сумма скидки (в процентах)
DISCOUNT_PERCENT_MIN: int = 1
DISCOUNT_PERCENT_MAX: int = 99
